(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,85313,e=>{"use strict";let t,s;e.i(47167);var n,r,i=e.i(43476);let o="1.28.0";for(var a=[],u=[],h=Uint8Array,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,d=l.length;c<d;++c)a[c]=l[c],u[l.charCodeAt(c)]=c;function f(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var s=e.indexOf("=");-1===s&&(s=t);var n=s===t?0:4-s%4;return[s,n]}function g(e){var t=f(e),s=t[0],n=t[1];return(s+n)*3/4-n}function y(e){var t,s,n=f(e),r=n[0],i=n[1],o=new h((r+i)*3/4-i),a=0,l=i>0?r-4:r;for(s=0;s<l;s+=4)t=u[e.charCodeAt(s)]<<18|u[e.charCodeAt(s+1)]<<12|u[e.charCodeAt(s+2)]<<6|u[e.charCodeAt(s+3)],o[a++]=t>>16&255,o[a++]=t>>8&255,o[a++]=255&t;return 2===i&&(t=u[e.charCodeAt(s)]<<2|u[e.charCodeAt(s+1)]>>4,o[a++]=255&t),1===i&&(t=u[e.charCodeAt(s)]<<10|u[e.charCodeAt(s+1)]<<4|u[e.charCodeAt(s+2)]>>2,o[a++]=t>>8&255,o[a++]=255&t),o}function p(e){for(var t,s=e.length,n=s%3,r=[],i=0,o=s-n;i<o;i+=16383)r.push(function(e,t,s){for(var n,r=[],i=t;i<s;i+=3)n=(e[i]<<16&0xff0000)+(e[i+1]<<8&65280)+(255&e[i+2]),r.push(a[n>>18&63]+a[n>>12&63]+a[n>>6&63]+a[63&n]);return r.join("")}(e,i,i+16383>o?o:i+16383));return 1===n?r.push(a[(t=e[s-1])>>2]+a[t<<4&63]+"=="):2===n&&r.push(a[(t=(e[s-2]<<8)+e[s-1])>>10]+a[t>>4&63]+a[t<<2&63]+"="),r.join("")}function m(e){return p(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function v(e){if(void 0===e)return{};if(!b(e))throw Error(`The arguments to a Convex function must be an object. Received: ${e}`);return e}function w(e){if(void 0===e)throw Error("Client created with undefined deployment address. If you used an environment variable, check that it's set.");if("string"!=typeof e)throw Error(`Invalid deployment address: found ${e}".`);if(!(e.startsWith("http:")||e.startsWith("https:")))throw Error(`Invalid deployment address: Must start with "https://" or "http://". Found "${e}".`);try{new URL(e)}catch{throw Error(`Invalid deployment address: "${e}" is not a valid URL. If you believe this URL is correct, use the \`skipConvexDeploymentUrlCheck\` option to bypass this.`)}if(e.endsWith(".convex.site"))throw Error(`Invalid deployment address: "${e}" ends with .convex.site, which is used for HTTP Actions. Convex deployment URLs typically end with .convex.cloud? If you believe this URL is correct, use the \`skipConvexDeploymentUrlCheck\` option to bypass this.`)}function b(e){let t="object"==typeof e,s=Object.getPrototypeOf(e),n=null===s||s===Object.prototype||s?.constructor?.name==="Object";return t&&n}u[45]=62,u[95]=63,e.s(["byteLength",()=>g,"fromByteArray",()=>p,"fromByteArrayUrlSafeNoPadding",()=>m,"toByteArray",()=>y],95543);let S=BigInt("-9223372036854775808"),k=BigInt("9223372036854775807"),C=BigInt("0"),A=BigInt("8"),R=BigInt("256");function T(e){return Number.isNaN(e)||!Number.isFinite(e)||Object.is(e,-0)}let q=DataView.prototype.setBigInt64?function(e){if(e<S||k<e)throw Error(`BigInt ${e} does not fit into a 64-bit signed integer.`);let t=new ArrayBuffer(8);return new DataView(t).setBigInt64(0,e,!0),p(new Uint8Array(t))}:function(e){e<C&&(e-=S+S);let t=e.toString(16);t.length%2==1&&(t="0"+t);let s=new Uint8Array(new ArrayBuffer(8)),n=0;for(let r of t.match(/.{2}/g).reverse())s.set([parseInt(r,16)],n++),e>>=A;return p(s)},x=DataView.prototype.getBigInt64?function(e){let t=y(e);if(8!==t.byteLength)throw Error(`Received ${t.byteLength} bytes, expected 8 for $integer`);return new DataView(t.buffer).getBigInt64(0,!0)}:function(e){let t=y(e);if(8!==t.byteLength)throw Error(`Received ${t.byteLength} bytes, expected 8 for $integer`);let s=C,n=C;for(let e of t)s+=BigInt(e)*R**n,n++;return s>k&&(s+=S+S),s};function $(e){if(e.length>1024)throw Error(`Field name ${e} exceeds maximum field name length 1024.`);if(e.startsWith("$"))throw Error(`Field name ${e} starts with a '$', which is reserved.`);for(let t=0;t<e.length;t+=1){let s=e.charCodeAt(t);if(s<32||s>=127)throw Error(`Field name ${e} has invalid character '${e[t]}': Field names can only contain non-control ASCII characters`)}}function M(e){if(null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e)return e;if(Array.isArray(e))return e.map(e=>M(e));if("object"!=typeof e)throw Error(`Unexpected type of ${e}`);let t=Object.entries(e);if(1===t.length){let s=t[0][0];if("$bytes"===s){if("string"!=typeof e.$bytes)throw Error(`Malformed $bytes field on ${e}`);return y(e.$bytes).buffer}if("$integer"===s){if("string"!=typeof e.$integer)throw Error(`Malformed $integer field on ${e}`);return x(e.$integer)}if("$float"===s){if("string"!=typeof e.$float)throw Error(`Malformed $float field on ${e}`);let t=y(e.$float);if(8!==t.byteLength)throw Error(`Received ${t.byteLength} bytes, expected 8 for $float`);let s=new DataView(t.buffer).getFloat64(0,!0);if(!T(s))throw Error(`Float ${s} should be encoded as a number`);return s}if("$set"===s)throw Error("Received a Set which is no longer supported as a Convex type.");if("$map"===s)throw Error("Received a Map which is no longer supported as a Convex type.")}let s={};for(let[t,n]of Object.entries(e))$(t),s[t]=M(n);return s}function I(e){return JSON.stringify(e,(e,t)=>void 0===t?"undefined":"bigint"==typeof t?`${t.toString()}n`:t)}function O(e,t,s,n){return e?`${t}${I(s)} is not a supported Convex type (present at path ${e} in original object ${I(n)}). To learn about Convex's supported types, see https://docs.convex.dev/using/types.`:`${t}${I(s)} is not a supported Convex type.`}function E(e){return function e(t,s,n,r){if(void 0===t){let e=n&&` (present at path ${n} in original object ${I(s)})`;throw Error(`undefined is not a valid Convex value${e}. To learn about Convex's supported types, see https://docs.convex.dev/using/types.`)}if(null===t)return t;if("bigint"==typeof t){if(t<S||k<t)throw Error(`BigInt ${t} does not fit into a 64-bit signed integer.`);return{$integer:q(t)}}if("number"==typeof t)if(!T(t))return t;else{let e=new ArrayBuffer(8);return new DataView(e).setFloat64(0,t,!0),{$float:p(new Uint8Array(e))}}if("boolean"==typeof t||"string"==typeof t)return t;if(t instanceof ArrayBuffer)return{$bytes:p(new Uint8Array(t))};if(Array.isArray(t))return t.map((t,r)=>e(t,s,n+`[${r}]`,!1));if(t instanceof Set)throw Error(O(n,"Set",[...t],s));if(t instanceof Map)throw Error(O(n,"Map",[...t],s));if(!b(t)){let e=t?.constructor?.name;throw Error(O(n,e?`${e} `:"",t,s))}let i={},o=Object.entries(t);for(let[t,a]of(o.sort(([e,t],[s,n])=>e===s?0:e<s?-1:1),o))void 0!==a?($(t),i[t]=e(a,s,n+`.${t}`,!1)):r&&($(t),i[t]=function(t,s,n){if(void 0===t)return{$undefined:null};if(void 0===s)throw Error(`Programming error. Current value is ${I(t)} but original value is undefined`);return e(t,s,n,!1)}(a,s,n+`.${t}`));return i}(e,e,"",!1)}var _=e.i(95543),V=Object.defineProperty,P=(e,t,s)=>{let n;return(n="symbol"!=typeof t?t+"":t)in e?V(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s};let L=Symbol.for("ConvexError");class Q extends(r=Error,n=L,r){constructor(e){super("string"==typeof e?e:I(e)),P(this,"name","ConvexError"),P(this,"data"),P(this,n,!0),this.data=e}}let F=()=>Array.from({length:4},()=>0);F(),F();var j=Object.defineProperty,D=(e,t,s)=>{let n;return(n="symbol"!=typeof t?t+"":t)in e?j(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s};function B(e){switch(e){case"query":return"Q";case"mutation":return"M";case"action":return"A";case"any":return"?"}}class U{constructor(e){D(this,"_onLogLineFuncs"),D(this,"_verbose"),this._onLogLineFuncs={},this._verbose=e.verbose}addLogLineListener(e){let t=Math.random().toString(36).substring(2,15);for(let e=0;e<10&&void 0!==this._onLogLineFuncs[t];e++)t=Math.random().toString(36).substring(2,15);return this._onLogLineFuncs[t]=e,()=>{delete this._onLogLineFuncs[t]}}logVerbose(...e){if(this._verbose)for(let t of Object.values(this._onLogLineFuncs))t("debug",`${new Date().toISOString()}`,...e)}log(...e){for(let t of Object.values(this._onLogLineFuncs))t("info",...e)}warn(...e){for(let t of Object.values(this._onLogLineFuncs))t("warn",...e)}error(...e){for(let t of Object.values(this._onLogLineFuncs))t("error",...e)}}function N(e){let t=new U(e);return t.addLogLineListener((e,...t)=>{switch(e){case"debug":console.debug(...t);break;case"info":default:console.log(...t);break;case"warn":console.warn(...t);break;case"error":console.error(...t)}}),t}function W(e,t,s,n,r){let i=B(s);if("object"==typeof r&&(r=`ConvexError ${JSON.stringify(r.errorData,null,2)}`),"info"===t){let t=r.match(/^\[.*?\] /);if(null===t)return void e.error(`[CONVEX ${i}(${n})] Could not parse console.log`);let s=r.slice(1,t[0].length-2),o=r.slice(t[0].length);e.log(`%c[CONVEX ${i}(${n})] [${s}]`,"color:rgb(0, 145, 255)",o)}else e.error(`[CONVEX ${i}(${n})] ${r}`)}function J(e,t,s){let n=B(e);return`[CONVEX ${n}(${t})] ${s.errorMessage}
  Called by client`}function z(e,t){return t.data=e.errorData,t}function H(e){let t,s,n=e.split(":");return 1===n.length?(t=n[0],s="default"):(t=n.slice(0,n.length-1).join(":"),s=n[n.length-1]),t.endsWith(".js")&&(t=t.slice(0,-3)),`${t}:${s}`}function G(e,t){return JSON.stringify({udfPath:H(e),args:E(t)})}var X=Object.defineProperty,K=(e,t,s)=>{let n;return(n="symbol"!=typeof t?t+"":t)in e?X(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s};class Y{constructor(){K(this,"nextQueryId"),K(this,"querySetVersion"),K(this,"querySet"),K(this,"queryIdToToken"),K(this,"identityVersion"),K(this,"auth"),K(this,"outstandingQueriesOlderThanRestart"),K(this,"outstandingAuthOlderThanRestart"),K(this,"paused"),K(this,"pendingQuerySetModifications"),this.nextQueryId=0,this.querySetVersion=0,this.identityVersion=0,this.querySet=new Map,this.queryIdToToken=new Map,this.outstandingQueriesOlderThanRestart=new Set,this.outstandingAuthOlderThanRestart=!1,this.paused=!1,this.pendingQuerySetModifications=new Map}hasSyncedPastLastReconnect(){return 0===this.outstandingQueriesOlderThanRestart.size&&!this.outstandingAuthOlderThanRestart}markAuthCompletion(){this.outstandingAuthOlderThanRestart=!1}subscribe(e,t,s,n){let r=H(e),i=G(r,t),o=this.querySet.get(i);if(void 0!==o)return o.numSubscribers+=1,{queryToken:i,modification:null,unsubscribe:()=>this.removeSubscriber(i)};{let e=this.nextQueryId++;this.querySet.set(i,{id:e,canonicalizedUdfPath:r,args:t,numSubscribers:1,journal:s,componentPath:n}),this.queryIdToToken.set(e,i);let o=this.querySetVersion,a=this.querySetVersion+1,u={type:"Add",queryId:e,udfPath:r,args:[E(t)],journal:s,componentPath:n};return this.paused?this.pendingQuerySetModifications.set(e,u):this.querySetVersion=a,{queryToken:i,modification:{type:"ModifyQuerySet",baseVersion:o,newVersion:a,modifications:[u]},unsubscribe:()=>this.removeSubscriber(i)}}}transition(e){for(let t of e.modifications)switch(t.type){case"QueryUpdated":case"QueryFailed":{this.outstandingQueriesOlderThanRestart.delete(t.queryId);let e=t.journal;if(void 0!==e){let s=this.queryIdToToken.get(t.queryId);void 0!==s&&(this.querySet.get(s).journal=e)}break}case"QueryRemoved":this.outstandingQueriesOlderThanRestart.delete(t.queryId);break;default:throw Error(`Invalid modification ${t.type}`)}}queryId(e,t){let s=G(H(e),t),n=this.querySet.get(s);return void 0!==n?n.id:null}isCurrentOrNewerAuthVersion(e){return e>=this.identityVersion}getAuth(){return this.auth}setAuth(e){this.auth={tokenType:"User",value:e};let t=this.identityVersion;return this.paused||(this.identityVersion=t+1),{type:"Authenticate",baseVersion:t,...this.auth}}setAdminAuth(e,t){let s={tokenType:"Admin",value:e,impersonating:t};this.auth=s;let n=this.identityVersion;return this.paused||(this.identityVersion=n+1),{type:"Authenticate",baseVersion:n,...s}}clearAuth(){this.auth=void 0,this.markAuthCompletion();let e=this.identityVersion;return this.paused||(this.identityVersion=e+1),{type:"Authenticate",tokenType:"None",baseVersion:e}}hasAuth(){return!!this.auth}isNewAuth(e){return this.auth?.value!==e}queryPath(e){let t=this.queryIdToToken.get(e);return t?this.querySet.get(t).canonicalizedUdfPath:null}queryArgs(e){let t=this.queryIdToToken.get(e);return t?this.querySet.get(t).args:null}queryToken(e){return this.queryIdToToken.get(e)??null}queryJournal(e){return this.querySet.get(e)?.journal}restart(e){this.unpause(),this.outstandingQueriesOlderThanRestart.clear();let t=[];for(let s of this.querySet.values()){let n={type:"Add",queryId:s.id,udfPath:s.canonicalizedUdfPath,args:[E(s.args)],journal:s.journal,componentPath:s.componentPath};t.push(n),e.has(s.id)||this.outstandingQueriesOlderThanRestart.add(s.id)}this.querySetVersion=1;let s={type:"ModifyQuerySet",baseVersion:0,newVersion:1,modifications:t};if(!this.auth)return this.identityVersion=0,[s,void 0];this.outstandingAuthOlderThanRestart=!0;let n={type:"Authenticate",baseVersion:0,...this.auth};return this.identityVersion=1,[s,n]}pause(){this.paused=!0}resume(){let e=this.pendingQuerySetModifications.size>0?{type:"ModifyQuerySet",baseVersion:this.querySetVersion,newVersion:++this.querySetVersion,modifications:Array.from(this.pendingQuerySetModifications.values())}:void 0,t=void 0!==this.auth?{type:"Authenticate",baseVersion:this.identityVersion++,...this.auth}:void 0;return this.unpause(),[e,t]}unpause(){this.paused=!1,this.pendingQuerySetModifications.clear()}removeSubscriber(e){let t=this.querySet.get(e);if(t.numSubscribers>1)return t.numSubscribers-=1,null;{this.querySet.delete(e),this.queryIdToToken.delete(t.id),this.outstandingQueriesOlderThanRestart.delete(t.id);let s=this.querySetVersion,n=this.querySetVersion+1,r={type:"Remove",queryId:t.id};return this.paused?this.pendingQuerySetModifications.has(t.id)?this.pendingQuerySetModifications.delete(t.id):this.pendingQuerySetModifications.set(t.id,r):this.querySetVersion=n,{type:"ModifyQuerySet",baseVersion:s,newVersion:n,modifications:[r]}}}}var Z=Object.defineProperty,ee=(e,t,s)=>{let n;return(n="symbol"!=typeof t?t+"":t)in e?Z(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s};class et{constructor(e,t){this.logger=e,this.markConnectionStateDirty=t,ee(this,"inflightRequests"),ee(this,"requestsOlderThanRestart"),ee(this,"inflightMutationsCount",0),ee(this,"inflightActionsCount",0),this.inflightRequests=new Map,this.requestsOlderThanRestart=new Set}request(e,t){let s=new Promise(s=>{this.inflightRequests.set(e.requestId,{message:e,status:{status:t?"Requested":"NotSent",requestedAt:new Date,onResult:s}}),"Mutation"===e.type?this.inflightMutationsCount++:"Action"===e.type&&this.inflightActionsCount++});return this.markConnectionStateDirty(),s}onResponse(e){let t,s,n=this.inflightRequests.get(e.requestId);if(void 0===n||"Completed"===n.status.status)return null;let r="Mutation"===n.message.type?"mutation":"action",i=n.message.udfPath;for(let t of e.logLines)W(this.logger,"info",r,i,t);let o=n.status;if(e.success)t={success:!0,logLines:e.logLines,value:M(e.result)},s=()=>o.onResult(t);else{let n=e.result,{errorData:a}=e;W(this.logger,"error",r,i,n),t={success:!1,errorMessage:n,errorData:void 0!==a?M(a):void 0,logLines:e.logLines},s=()=>o.onResult(t)}return"ActionResponse"!==e.type&&e.success?(n.status={status:"Completed",result:t,ts:e.ts,onResolve:s},null):(s(),this.inflightRequests.delete(e.requestId),this.requestsOlderThanRestart.delete(e.requestId),"Action"===n.message.type?this.inflightActionsCount--:"Mutation"===n.message.type&&this.inflightMutationsCount--,this.markConnectionStateDirty(),{requestId:e.requestId,result:t})}removeCompleted(e){let t=new Map;for(let[s,n]of this.inflightRequests.entries()){let r=n.status;"Completed"===r.status&&r.ts.lessThanOrEqual(e)&&(r.onResolve(),t.set(s,r.result),"Mutation"===n.message.type?this.inflightMutationsCount--:"Action"===n.message.type&&this.inflightActionsCount--,this.inflightRequests.delete(s),this.requestsOlderThanRestart.delete(s))}return t.size>0&&this.markConnectionStateDirty(),t}restart(){this.requestsOlderThanRestart=new Set(this.inflightRequests.keys());let e=[];for(let[t,s]of this.inflightRequests){if("NotSent"===s.status.status){s.status.status="Requested",e.push(s.message);continue}if("Mutation"===s.message.type)e.push(s.message);else if("Action"===s.message.type){if(this.inflightRequests.delete(t),this.requestsOlderThanRestart.delete(t),this.inflightActionsCount--,"Completed"===s.status.status)throw Error("Action should never be in 'Completed' state");s.status.onResult({success:!1,errorMessage:"Connection lost while action was in flight",logLines:[]})}}return this.markConnectionStateDirty(),e}resume(){let e=[];for(let[,t]of this.inflightRequests)if("NotSent"===t.status.status){t.status.status="Requested",e.push(t.message);continue}return e}hasIncompleteRequests(){for(let e of this.inflightRequests.values())if("Requested"===e.status.status)return!0;return!1}hasInflightRequests(){return this.inflightRequests.size>0}hasSyncedPastLastReconnect(){return 0===this.requestsOlderThanRestart.size}timeOfOldestInflightRequest(){if(0===this.inflightRequests.size)return null;let e=Date.now();for(let t of this.inflightRequests.values())"Completed"!==t.status.status&&t.status.requestedAt.getTime()<e&&(e=t.status.requestedAt.getTime());return new Date(e)}inflightMutations(){return this.inflightMutationsCount}inflightActions(){return this.inflightActionsCount}}let es=Symbol.for("functionName"),en=Symbol.for("toReferencePath");function er(e){let t=function(e){let t;if("string"==typeof e)t=e.startsWith("function://")?{functionHandle:e}:{name:e};else if(e[es])t={name:e[es]};else{let s=e[en]??null;if(!s)throw Error(`${e} is not a functionReference`);t={reference:s}}return t}(e);if(void 0===t.name){if(void 0!==t.functionHandle)throw Error(`Expected function reference like "api.file.func" or "internal.file.func", but received function handle ${t.functionHandle}`);if(void 0!==t.reference)throw Error(`Expected function reference in the current component like "api.file.func" or "internal.file.func", but received reference ${t.reference}`);throw Error(`Expected function reference like "api.file.func" or "internal.file.func", but received ${JSON.stringify(t)}`)}if("string"==typeof e)return e;let s=e[es];if(!s)throw Error(`${e} is not a functionReference`);return s}!function e(t=[]){return new Proxy({},{get(s,n){if("string"==typeof n)return e([...t,n]);if(n===es){if(t.length<2){let e=["api",...t].join(".");throw Error(`API path is expected to be of the form \`api.moduleName.functionName\`. Found: \`${e}\``)}let e=t.slice(0,-1).join("/"),s=t[t.length-1];return"default"===s?e:e+":"+s}return n===Symbol.toStringTag?"FunctionReference":void 0}})}();var ei=Object.defineProperty,eo=(e,t,s)=>{let n;return(n="symbol"!=typeof t?t+"":t)in e?ei(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s};class ea{constructor(e){eo(this,"queryResults"),eo(this,"modifiedQueries"),this.queryResults=e,this.modifiedQueries=[]}getQuery(e,...t){let s=v(t[0]),n=er(e),r=this.queryResults.get(G(n,s));if(void 0!==r)return ea.queryValue(r.result)}getAllQueries(e){let t=[],s=er(e);for(let e of this.queryResults.values())e.udfPath===H(s)&&t.push({args:e.args,value:ea.queryValue(e.result)});return t}setQuery(e,t,s){let n=v(t),r=er(e),i=G(r,n);this.queryResults.set(i,{udfPath:r,args:n,result:void 0===s?void 0:{success:!0,value:s,logLines:[]}}),this.modifiedQueries.push(i)}static queryValue(e){return void 0===e?void 0:e.success?e.value:void 0}}class eu{constructor(){eo(this,"queryResults"),eo(this,"optimisticUpdates"),this.queryResults=new Map,this.optimisticUpdates=[]}ingestQueryResultsFromServer(e,t){this.optimisticUpdates=this.optimisticUpdates.filter(e=>!t.has(e.mutationId));let s=this.queryResults;this.queryResults=new Map(e);let n=new ea(this.queryResults);for(let e of this.optimisticUpdates)e.update(n);let r=[];for(let[e,t]of this.queryResults){let n=s.get(e);(void 0===n||n.result!==t.result)&&r.push(e)}return r}applyOptimisticUpdate(e,t){this.optimisticUpdates.push({update:e,mutationId:t});let s=new ea(this.queryResults);return e(s),s.modifiedQueries}rawQueryResult(e){return this.queryResults.get(e)}queryResult(e){let t=this.queryResults.get(e);if(void 0===t)return;let s=t.result;if(void 0!==s){if(s.success)return s.value;if(void 0!==s.errorData)throw z(s,new Q(J("query",t.udfPath,s)));throw Error(J("query",t.udfPath,s))}}hasQueryResult(e){return void 0!==this.queryResults.get(e)}queryLogs(e){let t=this.queryResults.get(e);return t?.result?.logLines}}var eh=Object.defineProperty,el=(e,t,s)=>{let n;return(n="symbol"!=typeof t?t+"":t)in e?eh(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s};class ec{constructor(e,t){el(this,"low"),el(this,"high"),el(this,"__isUnsignedLong__"),this.low=0|e,this.high=0|t,this.__isUnsignedLong__=!0}static isLong(e){return!0===(e&&e.__isUnsignedLong__)}static fromBytesLE(e){return new ec(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24)}toBytesLE(){let e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]}static fromNumber(e){return isNaN(e)||e<0?ed:e>=eg?ey:new ec(e%ef|0,e/ef|0)}toString(){return(BigInt(this.high)*BigInt(ef)+BigInt(this.low)).toString()}equals(e){return ec.isLong(e)||(e=ec.fromValue(e)),(this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low}notEquals(e){return!this.equals(e)}comp(e){return(ec.isLong(e)||(e=ec.fromValue(e)),this.equals(e))?0:e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1}lessThanOrEqual(e){return 0>=this.comp(e)}static fromValue(e){return"number"==typeof e?ec.fromNumber(e):new ec(e.low,e.high)}}let ed=new ec(0,0),ef=0x100000000,eg=0xffffffffffffffff,ey=new ec(-1,-1);var ep=Object.defineProperty,em=(e,t,s)=>{let n;return(n="symbol"!=typeof t?t+"":t)in e?ep(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s};class ev{constructor(e,t){em(this,"version"),em(this,"remoteQuerySet"),em(this,"queryPath"),em(this,"logger"),this.version={querySet:0,ts:ec.fromNumber(0),identity:0},this.remoteQuerySet=new Map,this.queryPath=e,this.logger=t}transition(e){let t=e.startVersion;if(this.version.querySet!==t.querySet||this.version.ts.notEquals(t.ts)||this.version.identity!==t.identity)throw Error(`Invalid start version: ${t.ts.toString()}:${t.querySet}:${t.identity}, transitioning from ${this.version.ts.toString()}:${this.version.querySet}:${this.version.identity}`);for(let t of e.modifications)switch(t.type){case"QueryUpdated":{let e=this.queryPath(t.queryId);if(e)for(let s of t.logLines)W(this.logger,"info","query",e,s);let s=M(t.value??null);this.remoteQuerySet.set(t.queryId,{success:!0,value:s,logLines:t.logLines});break}case"QueryFailed":{let e=this.queryPath(t.queryId);if(e)for(let s of t.logLines)W(this.logger,"info","query",e,s);let{errorData:s}=t;this.remoteQuerySet.set(t.queryId,{success:!1,errorMessage:t.errorMessage,errorData:void 0!==s?M(s):void 0,logLines:t.logLines});break}case"QueryRemoved":this.remoteQuerySet.delete(t.queryId);break;default:throw Error(`Invalid modification ${t.type}`)}this.version=e.endVersion}remoteQueryResults(){return this.remoteQuerySet}timestamp(){return this.version.ts}}function ew(e){let t=_.toByteArray(e);return ec.fromBytesLE(Array.from(t))}function eb(e){switch(e.type){case"FatalError":case"AuthError":case"ActionResponse":case"TransitionChunk":case"Ping":return{...e};case"MutationResponse":if(e.success)return{...e,ts:ew(e.ts)};return{...e};case"Transition":return{...e,startVersion:{...e.startVersion,ts:ew(e.startVersion.ts)},endVersion:{...e.endVersion,ts:ew(e.endVersion.ts)}}}}var eS=Object.defineProperty,ek=(e,t,s)=>{let n;return(n="symbol"!=typeof t?t+"":t)in e?eS(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s};function eC(){return(void 0===t&&(t=Date.now()),"undefined"!=typeof performance&&performance.now)?Math.round(t+performance.now()):Date.now()}function eA(){return`t=${Math.round((eC()-t)/100)/10}s`}let eR={InternalServerError:{timeout:1e3},SubscriptionsWorkerFullError:{timeout:3e3},TooManyConcurrentRequests:{timeout:3e3},CommitterFullError:{timeout:3e3},AwsTooManyRequestsException:{timeout:3e3},ExecuteFullError:{timeout:3e3},SystemTimeoutError:{timeout:3e3},ExpiredInQueue:{timeout:3e3},VectorIndexesUnavailable:{timeout:1e3},SearchIndexesUnavailable:{timeout:1e3},TableSummariesUnavailable:{timeout:1e3},VectorIndexTooLarge:{timeout:3e3},SearchIndexTooLarge:{timeout:3e3},TooManyWritesInTimePeriod:{timeout:3e3}};class eT{constructor(e,t,s,n,r,i){this.markConnectionStateDirty=r,this.debug=i,ek(this,"socket"),ek(this,"connectionCount"),ek(this,"_hasEverConnected",!1),ek(this,"lastCloseReason"),ek(this,"transitionChunkBuffer",null),ek(this,"defaultInitialBackoff"),ek(this,"maxBackoff"),ek(this,"retries"),ek(this,"serverInactivityThreshold"),ek(this,"reconnectDueToServerInactivityTimeout"),ek(this,"uri"),ek(this,"onOpen"),ek(this,"onResume"),ek(this,"onMessage"),ek(this,"webSocketConstructor"),ek(this,"logger"),ek(this,"onServerDisconnectError"),this.webSocketConstructor=s,this.socket={state:"disconnected"},this.connectionCount=0,this.lastCloseReason="InitialConnect",this.defaultInitialBackoff=1e3,this.maxBackoff=16e3,this.retries=0,this.serverInactivityThreshold=6e4,this.reconnectDueToServerInactivityTimeout=null,this.uri=e,this.onOpen=t.onOpen,this.onResume=t.onResume,this.onMessage=t.onMessage,this.onServerDisconnectError=t.onServerDisconnectError,this.logger=n,this.connect()}setSocketState(e){this.socket=e,this._logVerbose(`socket state changed: ${this.socket.state}, paused: ${"paused"in this.socket?this.socket.paused:void 0}`),this.markConnectionStateDirty()}assembleTransition(e){if(e.partNumber<0||e.partNumber>=e.totalParts||0===e.totalParts||this.transitionChunkBuffer&&(this.transitionChunkBuffer.totalParts!==e.totalParts||this.transitionChunkBuffer.transitionId!==e.transitionId))throw this.transitionChunkBuffer=null,Error("Invalid TransitionChunk");if(null===this.transitionChunkBuffer&&(this.transitionChunkBuffer={chunks:[],totalParts:e.totalParts,transitionId:e.transitionId}),e.partNumber!==this.transitionChunkBuffer.chunks.length){let t=this.transitionChunkBuffer.chunks.length;throw this.transitionChunkBuffer=null,Error(`TransitionChunk received out of order: expected part ${t}, got ${e.partNumber}`)}if(this.transitionChunkBuffer.chunks.push(e.chunk),this.transitionChunkBuffer.chunks.length===e.totalParts){let e=this.transitionChunkBuffer.chunks.join("");this.transitionChunkBuffer=null;let t=eb(JSON.parse(e));if("Transition"!==t.type)throw Error(`Expected Transition, got ${t.type} after assembling chunks`);return t}return null}connect(){if("terminated"===this.socket.state)return;if("disconnected"!==this.socket.state&&"stopped"!==this.socket.state)throw Error("Didn't start connection from disconnected state: "+this.socket.state);let e=new this.webSocketConstructor(this.uri);this._logVerbose("constructed WebSocket"),this.setSocketState({state:"connecting",ws:e,paused:"no"}),this.resetServerInactivityTimeout(),e.onopen=()=>{if(this.logger.logVerbose("begin ws.onopen"),"connecting"!==this.socket.state)throw Error("onopen called with socket not in connecting state");this.setSocketState({state:"ready",ws:e,paused:"yes"===this.socket.paused?"uninitialized":"no"}),this.resetServerInactivityTimeout(),"no"===this.socket.paused&&(this._hasEverConnected=!0,this.onOpen({connectionCount:this.connectionCount,lastCloseReason:this.lastCloseReason,clientTs:eC()})),"InitialConnect"!==this.lastCloseReason&&(this.lastCloseReason?this.logger.log("WebSocket reconnected at",eA(),"after disconnect due to",this.lastCloseReason):this.logger.log("WebSocket reconnected at",eA())),this.connectionCount+=1,this.lastCloseReason=null},e.onerror=e=>{this.transitionChunkBuffer=null;let t=e.message;t&&this.logger.log(`WebSocket error message: ${t}`)},e.onmessage=e=>{this.resetServerInactivityTimeout();let t=e.data.length,s=eb(JSON.parse(e.data));if(this._logVerbose(`received ws message with type ${s.type}`),"Ping"!==s.type){if("TransitionChunk"===s.type){let e=this.assembleTransition(s);if(!e)return;s=e,this._logVerbose(`assembled full ws message of type ${s.type}`)}null!==this.transitionChunkBuffer&&(this.transitionChunkBuffer=null,this.logger.log(`Received unexpected ${s.type} while buffering TransitionChunks`)),"Transition"===s.type&&this.reportLargeTransition({messageLength:t,transition:s}),this.onMessage(s).hasSyncedPastLastReconnect&&(this.retries=0,this.markConnectionStateDirty())}},e.onclose=e=>{if(this._logVerbose("begin ws.onclose"),this.transitionChunkBuffer=null,null===this.lastCloseReason&&(this.lastCloseReason=e.reason||`closed with code ${e.code}`),1e3!==e.code&&1001!==e.code&&1005!==e.code&&4040!==e.code){let t=`WebSocket closed with code ${e.code}`;e.reason&&(t+=`: ${e.reason}`),this.logger.log(t),this.onServerDisconnectError&&e.reason&&this.onServerDisconnectError(t)}let t=function(e){if(void 0===e)return"Unknown";for(let t of Object.keys(eR))if(e.startsWith(t))return t;return"Unknown"}(e.reason);this.scheduleReconnect(t)}}socketState(){return this.socket.state}sendMessage(e){let t={type:e.type,..."Authenticate"===e.type&&"User"===e.tokenType?{value:`...${e.value.slice(-7)}`}:{}};if("ready"===this.socket.state&&"no"===this.socket.paused){let s=JSON.stringify(function(e){switch(e.type){case"Authenticate":case"ModifyQuerySet":case"Mutation":case"Action":case"Event":return{...e};case"Connect":let t;if(void 0===e.maxObservedTimestamp)return{...e,maxObservedTimestamp:void 0};return{...e,maxObservedTimestamp:(t=new Uint8Array(e.maxObservedTimestamp.toBytesLE()),_.fromByteArray(t))}}}(e)),n=!1;try{this.socket.ws.send(s),n=!0}catch(e){this.logger.log(`Failed to send message on WebSocket, reconnecting: ${e}`),this.closeAndReconnect("FailedToSendMessage")}return this._logVerbose(`${n?"sent":"failed to send"} message with type ${e.type}: ${JSON.stringify(t)}`),!0}return this._logVerbose(`message not sent (socket state: ${this.socket.state}, paused: ${"paused"in this.socket?this.socket.paused:void 0}): ${JSON.stringify(t)}`),!1}resetServerInactivityTimeout(){"terminated"!==this.socket.state&&(null!==this.reconnectDueToServerInactivityTimeout&&(clearTimeout(this.reconnectDueToServerInactivityTimeout),this.reconnectDueToServerInactivityTimeout=null),this.reconnectDueToServerInactivityTimeout=setTimeout(()=>{this.closeAndReconnect("InactiveServer")},this.serverInactivityThreshold))}scheduleReconnect(e){this.socket={state:"disconnected"};let t=this.nextBackoff(e);this.markConnectionStateDirty(),this.logger.log(`Attempting reconnect in ${Math.round(t)}ms`),setTimeout(()=>this.connect(),t)}closeAndReconnect(e){switch(this._logVerbose(`begin closeAndReconnect with reason ${e}`),this.socket.state){case"disconnected":case"terminated":case"stopped":return;case"connecting":case"ready":this.lastCloseReason=e,this.close(),this.scheduleReconnect("client");return;default:this.socket}}close(){switch(this.transitionChunkBuffer=null,this.socket.state){case"disconnected":case"terminated":case"stopped":return Promise.resolve();case"connecting":{let e=this.socket.ws;return e.onmessage=e=>{this._logVerbose("Ignoring message received after close")},new Promise(t=>{e.onclose=()=>{this._logVerbose("Closed after connecting"),t()},e.onopen=()=>{this._logVerbose("Opened after connecting"),e.close()}})}case"ready":{this._logVerbose("ws.close called");let e=this.socket.ws;e.onmessage=e=>{this._logVerbose("Ignoring message received after close")};let t=new Promise(t=>{e.onclose=()=>{t()}});return e.close(),t}default:return this.socket,Promise.resolve()}}terminate(){switch(this.reconnectDueToServerInactivityTimeout&&clearTimeout(this.reconnectDueToServerInactivityTimeout),this.socket.state){case"terminated":case"stopped":case"disconnected":case"connecting":case"ready":{let e=this.close();return this.setSocketState({state:"terminated"}),e}default:throw this.socket,Error(`Invalid websocket state: ${this.socket.state}`)}}stop(){switch(this.socket.state){case"terminated":return Promise.resolve();case"connecting":case"stopped":case"disconnected":case"ready":{let e=this.close();return this.socket={state:"stopped"},e}default:return this.socket,Promise.resolve()}}tryRestart(){switch(this.socket.state){case"stopped":break;case"terminated":case"connecting":case"ready":case"disconnected":this.logger.logVerbose("Restart called without stopping first");return;default:this.socket}this.connect()}pause(){switch(this.socket.state){case"disconnected":case"stopped":case"terminated":return;case"connecting":case"ready":this.socket={...this.socket,paused:"yes"};return;default:return void this.socket}}resume(){switch(this.socket.state){case"connecting":this.socket={...this.socket,paused:"no"};return;case"ready":"uninitialized"===this.socket.paused?(this.socket={...this.socket,paused:"no"},this.onOpen({connectionCount:this.connectionCount,lastCloseReason:this.lastCloseReason,clientTs:eC()})):"yes"===this.socket.paused&&(this.socket={...this.socket,paused:"no"},this.onResume());return;case"terminated":case"stopped":case"disconnected":return;default:this.socket}this.connect()}connectionState(){return{isConnected:"ready"===this.socket.state,hasEverConnected:this._hasEverConnected,connectionCount:this.connectionCount,connectionRetries:this.retries}}_logVerbose(e){this.logger.logVerbose(e)}nextBackoff(e){let t=("client"===e?100:"Unknown"===e?this.defaultInitialBackoff:eR[e].timeout)*Math.pow(2,this.retries);this.retries+=1;let s=Math.min(t,this.maxBackoff),n=s*(Math.random()-.5);return s+n}reportLargeTransition({transition:e,messageLength:t}){if(void 0===e.clientClockSkew||void 0===e.serverTs)return;let s=eC()-e.clientClockSkew-e.serverTs/1e6,n=`${Math.round(s)}ms`,r=`${Math.round(t/1e4)/100}MB`,i=t/(s/1e3),o=`${Math.round(i/1e4)/100}MB per second`;this._logVerbose(`received ${r} transition in ${n} at ${o}`),t>2e7?this.logger.log(`received query results totaling more that 20MB (${r}) which will take a long time to download on slower connections`):s>2e4&&this.logger.log(`received query results totaling ${r} which took more than 20s to arrive (${n})`),this.debug&&this.sendMessage({type:"Event",eventType:"ClientReceivedTransition",event:{transitionTransitTime:s,messageLength:t}})}}class eq extends Error{}function ex(e,t){let s;if("string"!=typeof e)throw new eq("Invalid token specified: must be a string");t||(t={});let n=+(!0!==t.header),r=e.split(".")[n];if("string"!=typeof r)throw new eq(`Invalid token specified: missing part #${n+1}`);try{s=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw Error("base64 string is not of the correct length")}try{var s;return s=t,decodeURIComponent(atob(s).replace(/(.)/g,(e,t)=>{let s=t.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}catch{return atob(t)}}(r)}catch(e){throw new eq(`Invalid token specified: invalid base64 for part #${n+1} (${e.message})`)}try{return JSON.parse(s)}catch(e){throw new eq(`Invalid token specified: invalid json for part #${n+1} (${e.message})`)}}eq.prototype.name="InvalidTokenError";var e$=Object.defineProperty,eM=(e,t,s)=>{let n;return(n="symbol"!=typeof t?t+"":t)in e?e$(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s};class eI{constructor(e,t,s){eM(this,"authState",{state:"noAuth"}),eM(this,"configVersion",0),eM(this,"syncState"),eM(this,"authenticate"),eM(this,"stopSocket"),eM(this,"tryRestartSocket"),eM(this,"pauseSocket"),eM(this,"resumeSocket"),eM(this,"clearAuth"),eM(this,"logger"),eM(this,"refreshTokenLeewaySeconds"),eM(this,"tokenConfirmationAttempts",0),this.syncState=e,this.authenticate=t.authenticate,this.stopSocket=t.stopSocket,this.tryRestartSocket=t.tryRestartSocket,this.pauseSocket=t.pauseSocket,this.resumeSocket=t.resumeSocket,this.clearAuth=t.clearAuth,this.logger=s.logger,this.refreshTokenLeewaySeconds=s.refreshTokenLeewaySeconds}async setConfig(e,t){this.resetAuthState(),this._logVerbose("pausing WS for auth token fetch"),this.pauseSocket();let s=await this.fetchTokenAndGuardAgainstRace(e,{forceRefreshToken:!1});s.isFromOutdatedConfig||(s.value?(this.setAuthState({state:"waitingForServerConfirmationOfCachedToken",config:{fetchToken:e,onAuthChange:t},hasRetried:!1}),this.authenticate(s.value)):(this.setAuthState({state:"initialRefetch",config:{fetchToken:e,onAuthChange:t}}),await this.refetchToken()),this._logVerbose("resuming WS after auth token fetch"),this.resumeSocket())}onTransition(e){if(this.syncState.isCurrentOrNewerAuthVersion(e.endVersion.identity)&&!(e.endVersion.identity<=e.startVersion.identity)){if("waitingForServerConfirmationOfCachedToken"===this.authState.state){this._logVerbose("server confirmed auth token is valid"),this.refetchToken(),this.authState.config.onAuthChange(!0);return}"waitingForServerConfirmationOfFreshToken"===this.authState.state&&(this._logVerbose("server confirmed new auth token is valid"),this.scheduleTokenRefetch(this.authState.token),this.tokenConfirmationAttempts=0,this.authState.hadAuth||this.authState.config.onAuthChange(!0))}}onAuthError(e){if(!1===e.authUpdateAttempted&&("waitingForServerConfirmationOfFreshToken"===this.authState.state||"waitingForServerConfirmationOfCachedToken"===this.authState.state))return void this._logVerbose("ignoring non-auth token expired error");let{baseVersion:t}=e;this.syncState.isCurrentOrNewerAuthVersion(t+1)?this.tryToReauthenticate(e):this._logVerbose("ignoring auth error for previous auth attempt")}async tryToReauthenticate(e){if(this._logVerbose(`attempting to reauthenticate: ${e.error}`),"noAuth"===this.authState.state||"waitingForServerConfirmationOfFreshToken"===this.authState.state&&this.tokenConfirmationAttempts>=2){this.logger.error(`Failed to authenticate: "${e.error}", check your server auth config`),this.syncState.hasAuth()&&this.syncState.clearAuth(),"noAuth"!==this.authState.state&&this.setAndReportAuthFailed(this.authState.config.onAuthChange);return}"waitingForServerConfirmationOfFreshToken"===this.authState.state&&(this.tokenConfirmationAttempts++,this._logVerbose(`retrying reauthentication, ${2-this.tokenConfirmationAttempts} attempts remaining`)),await this.stopSocket();let t=await this.fetchTokenAndGuardAgainstRace(this.authState.config.fetchToken,{forceRefreshToken:!0});t.isFromOutdatedConfig||(t.value&&this.syncState.isNewAuth(t.value)?(this.authenticate(t.value),this.setAuthState({state:"waitingForServerConfirmationOfFreshToken",config:this.authState.config,token:t.value,hadAuth:"notRefetching"===this.authState.state||"waitingForScheduledRefetch"===this.authState.state})):(this._logVerbose("reauthentication failed, could not fetch a new token"),this.syncState.hasAuth()&&this.syncState.clearAuth(),this.setAndReportAuthFailed(this.authState.config.onAuthChange)),this.tryRestartSocket())}async refetchToken(){if("noAuth"===this.authState.state)return;this._logVerbose("refetching auth token");let e=await this.fetchTokenAndGuardAgainstRace(this.authState.config.fetchToken,{forceRefreshToken:!0});e.isFromOutdatedConfig||(e.value?this.syncState.isNewAuth(e.value)?(this.setAuthState({state:"waitingForServerConfirmationOfFreshToken",hadAuth:this.syncState.hasAuth(),token:e.value,config:this.authState.config}),this.authenticate(e.value)):this.setAuthState({state:"notRefetching",config:this.authState.config}):(this._logVerbose("refetching token failed"),this.syncState.hasAuth()&&this.clearAuth(),this.setAndReportAuthFailed(this.authState.config.onAuthChange)),this._logVerbose("restarting WS after auth token fetch (if currently stopped)"),this.tryRestartSocket())}scheduleTokenRefetch(e){if("noAuth"===this.authState.state)return;let t=this.decodeToken(e);if(!t)return void this.logger.error("Auth token is not a valid JWT, cannot refetch the token");let{iat:s,exp:n}=t;if(!s||!n)return void this.logger.error("Auth token does not have required fields, cannot refetch the token");let r=n-s;if(r<=2)return void this.logger.error("Auth token does not live long enough, cannot refetch the token");let i=Math.min(1728e6,(r-this.refreshTokenLeewaySeconds)*1e3);i<=0&&(this.logger.warn(`Refetching auth token immediately, configured leeway ${this.refreshTokenLeewaySeconds}s is larger than the token's lifetime ${r}s`),i=0);let o=setTimeout(()=>{this._logVerbose("running scheduled token refetch"),this.refetchToken()},i);this.setAuthState({state:"waitingForScheduledRefetch",refetchTokenTimeoutId:o,config:this.authState.config}),this._logVerbose(`scheduled preemptive auth token refetching in ${i}ms`)}async fetchTokenAndGuardAgainstRace(e,t){let s=++this.configVersion;this._logVerbose(`fetching token with config version ${s}`);let n=await e(t);return this.configVersion!==s?(this._logVerbose(`stale config version, expected ${s}, got ${this.configVersion}`),{isFromOutdatedConfig:!0}):{isFromOutdatedConfig:!1,value:n}}stop(){this.resetAuthState(),this.configVersion++,this._logVerbose(`config version bumped to ${this.configVersion}`)}setAndReportAuthFailed(e){e(!1),this.resetAuthState()}resetAuthState(){this.setAuthState({state:"noAuth"})}setAuthState(e){let t="waitingForServerConfirmationOfFreshToken"===e.state?{hadAuth:e.hadAuth,state:e.state,token:`...${e.token.slice(-7)}`}:{state:e.state};switch(this._logVerbose(`setting auth state to ${JSON.stringify(t)}`),e.state){case"waitingForScheduledRefetch":case"notRefetching":case"noAuth":this.tokenConfirmationAttempts=0}"waitingForScheduledRefetch"===this.authState.state&&(clearTimeout(this.authState.refetchTokenTimeoutId),this.syncState.markAuthCompletion()),this.authState=e}decodeToken(e){try{return ex(e)}catch(e){return this._logVerbose(`Error decoding token: ${e instanceof Error?e.message:"Unknown error"}`),null}}_logVerbose(e){this.logger.logVerbose(`${e} [v${this.configVersion}]`)}}let eO=["convexClientConstructed","convexWebSocketOpen","convexFirstMessageReceived"];function eE(e){let t=e.name.slice(6);return{name:t=t.charAt(0).toLowerCase()+t.slice(1),startTime:e.startTime}}var e_=Object.defineProperty,eV=(e,t,s)=>{let n;return(n="symbol"!=typeof t?t+"":t)in e?e_(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s};class eP{constructor(e,t,s){let n;if(eV(this,"address"),eV(this,"state"),eV(this,"requestManager"),eV(this,"webSocketManager"),eV(this,"authenticationManager"),eV(this,"remoteQuerySet"),eV(this,"optimisticQueryResults"),eV(this,"_transitionHandlerCounter",0),eV(this,"_nextRequestId"),eV(this,"_onTransitionFns",new Map),eV(this,"_sessionId"),eV(this,"firstMessageReceived",!1),eV(this,"debug"),eV(this,"logger"),eV(this,"maxObservedTimestamp"),eV(this,"connectionStateSubscribers",new Map),eV(this,"nextConnectionStateSubscriberId",0),eV(this,"_lastPublishedConnectionState"),eV(this,"markConnectionStateDirty",()=>{Promise.resolve().then(()=>{let e=this.connectionState();if(JSON.stringify(e)!==JSON.stringify(this._lastPublishedConnectionState))for(let t of(this._lastPublishedConnectionState=e,this.connectionStateSubscribers.values()))t(e)})}),eV(this,"mark",e=>{var t;this.debug&&(t=this.sessionId,"undefined"!=typeof performance&&performance.mark&&performance.mark(e,{detail:{sessionId:t}}))}),"object"==typeof e)throw Error("Passing a ClientConfig object is no longer supported. Pass the URL of the Convex deployment as a string directly.");s?.skipConvexDeploymentUrlCheck!==!0&&w(e);const r=(s={...s}).authRefreshTokenLeewaySeconds??2;let i=s.webSocketConstructor;if(!i&&"undefined"==typeof WebSocket)throw Error("No WebSocket global variable defined! To use Convex in an environment without WebSocket try the HTTP client: https://docs.convex.dev/api/classes/browser.ConvexHttpClient");i=i||WebSocket,this.debug=s.reportDebugInfoToConvex??!1,this.address=e,this.logger=!1===s.logger?new U({verbose:s.verbose??!1}):!0!==s.logger&&s.logger?s.logger:N({verbose:s.verbose??!1});const a=e.search("://");if(-1===a)throw Error("Provided address was not an absolute URL.");const u=e.substring(a+3),h=e.substring(0,a);if("http"===h)n="ws";else if("https"===h)n="wss";else throw Error(`Unknown parent protocol ${h}`);const l=`${n}://${u}/api/${o}/sync`;this.state=new Y,this.remoteQuerySet=new ev(e=>this.state.queryPath(e),this.logger),this.requestManager=new et(this.logger,this.markConnectionStateDirty);const c=()=>{this.webSocketManager.pause(),this.state.pause()};this.authenticationManager=new eI(this.state,{authenticate:e=>{let t=this.state.setAuth(e);return this.webSocketManager.sendMessage(t),t.baseVersion},stopSocket:()=>this.webSocketManager.stop(),tryRestartSocket:()=>this.webSocketManager.tryRestart(),pauseSocket:c,resumeSocket:()=>this.webSocketManager.resume(),clearAuth:()=>{this.clearAuth()}},{logger:this.logger,refreshTokenLeewaySeconds:r}),this.optimisticQueryResults=new eu,this.addOnTransitionHandler(e=>{t(e.queries.map(e=>e.token))}),this._nextRequestId=0,this._sessionId="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});const{unsavedChangesWarning:d}=s;if("undefined"==typeof window||void 0===window.addEventListener){if(!0===d)throw Error("unsavedChangesWarning requested, but window.addEventListener not found! Remove {unsavedChangesWarning: true} from Convex client options.")}else!1!==d&&window.addEventListener("beforeunload",e=>{if(this.requestManager.hasIncompleteRequests()){e.preventDefault();let t="Are you sure you want to leave? Your changes may not be saved.";return(e||window.event).returnValue=t,t}});this.webSocketManager=new eT(l,{onOpen:e=>{this.mark("convexWebSocketOpen"),this.webSocketManager.sendMessage({...e,type:"Connect",sessionId:this._sessionId,maxObservedTimestamp:this.maxObservedTimestamp});let t=new Set(this.remoteQuerySet.remoteQueryResults().keys());this.remoteQuerySet=new ev(e=>this.state.queryPath(e),this.logger);let[s,n]=this.state.restart(t);for(let e of(n&&this.webSocketManager.sendMessage(n),this.webSocketManager.sendMessage(s),this.requestManager.restart()))this.webSocketManager.sendMessage(e)},onResume:()=>{let[e,t]=this.state.resume();for(let s of(t&&this.webSocketManager.sendMessage(t),e&&this.webSocketManager.sendMessage(e),this.requestManager.resume()))this.webSocketManager.sendMessage(s)},onMessage:e=>{switch(!this.firstMessageReceived&&(this.firstMessageReceived=!0,this.mark("convexFirstMessageReceived"),this.reportMarks()),e.type){case"Transition":{this.observedTimestamp(e.endVersion.ts),this.authenticationManager.onTransition(e),this.remoteQuerySet.transition(e),this.state.transition(e);let t=this.requestManager.removeCompleted(this.remoteQuerySet.timestamp());this.notifyOnQueryResultChanges(t);break}case"MutationResponse":{e.success&&this.observedTimestamp(e.ts);let t=this.requestManager.onResponse(e);null!==t&&this.notifyOnQueryResultChanges(new Map([[t.requestId,t.result]]));break}case"ActionResponse":this.requestManager.onResponse(e);break;case"AuthError":this.authenticationManager.onAuthError(e);break;case"FatalError":{var t,s;let n,r=(t=this.logger,s=e.error,n=`[CONVEX FATAL ERROR] ${s}`,t.error(n),Error(n));throw this.webSocketManager.terminate(),r}}return{hasSyncedPastLastReconnect:this.hasSyncedPastLastReconnect()}},onServerDisconnectError:s.onServerDisconnectError},i,this.logger,this.markConnectionStateDirty,this.debug),this.mark("convexClientConstructed"),s.expectAuth&&c()}hasSyncedPastLastReconnect(){return this.requestManager.hasSyncedPastLastReconnect()||this.state.hasSyncedPastLastReconnect()}observedTimestamp(e){(void 0===this.maxObservedTimestamp||this.maxObservedTimestamp.lessThanOrEqual(e))&&(this.maxObservedTimestamp=e)}getMaxObservedTimestamp(){return this.maxObservedTimestamp}notifyOnQueryResultChanges(e){let t=this.remoteQuerySet.remoteQueryResults(),s=new Map;for(let[e,n]of t){let t=this.state.queryToken(e);if(null!==t){let r={result:n,udfPath:this.state.queryPath(e),args:this.state.queryArgs(e)};s.set(t,r)}}let n=this.optimisticQueryResults.ingestQueryResultsFromServer(s,new Set(e.keys()));this.handleTransition({queries:n.map(e=>{let t=this.optimisticQueryResults.rawQueryResult(e);return{token:e,modification:{kind:"Updated",result:t.result}}}),reflectedMutations:Array.from(e).map(([e,t])=>({requestId:e,result:t})),timestamp:this.remoteQuerySet.timestamp()})}handleTransition(e){for(let t of this._onTransitionFns.values())t(e)}addOnTransitionHandler(e){let t=this._transitionHandlerCounter++;return this._onTransitionFns.set(t,e),()=>this._onTransitionFns.delete(t)}getCurrentAuthClaims(){let e=this.state.getAuth(),t={};if(e&&"User"===e.tokenType){try{t=e?ex(e.value):{}}catch{t={}}return{token:e.value,decoded:t}}}setAuth(e,t){this.authenticationManager.setConfig(e,t)}hasAuth(){return this.state.hasAuth()}setAdminAuth(e,t){let s=this.state.setAdminAuth(e,t);this.webSocketManager.sendMessage(s)}clearAuth(){let e=this.state.clearAuth();this.webSocketManager.sendMessage(e)}subscribe(e,t,s){let n=v(t),{modification:r,queryToken:i,unsubscribe:o}=this.state.subscribe(e,n,s?.journal,s?.componentPath);return null!==r&&this.webSocketManager.sendMessage(r),{queryToken:i,unsubscribe:()=>{let e=o();e&&this.webSocketManager.sendMessage(e)}}}localQueryResult(e,t){let s=G(e,v(t));return this.optimisticQueryResults.queryResult(s)}localQueryResultByToken(e){return this.optimisticQueryResults.queryResult(e)}hasLocalQueryResultByToken(e){return this.optimisticQueryResults.hasQueryResult(e)}localQueryLogs(e,t){let s=G(e,v(t));return this.optimisticQueryResults.queryLogs(s)}queryJournal(e,t){let s=G(e,v(t));return this.state.queryJournal(s)}connectionState(){let e=this.webSocketManager.connectionState();return{hasInflightRequests:this.requestManager.hasInflightRequests(),isWebSocketConnected:e.isConnected,hasEverConnected:e.hasEverConnected,connectionCount:e.connectionCount,connectionRetries:e.connectionRetries,timeOfOldestInflightRequest:this.requestManager.timeOfOldestInflightRequest(),inflightMutations:this.requestManager.inflightMutations(),inflightActions:this.requestManager.inflightActions()}}subscribeToConnectionState(e){let t=this.nextConnectionStateSubscriberId++;return this.connectionStateSubscribers.set(t,e),()=>{this.connectionStateSubscribers.delete(t)}}async mutation(e,t,s){let n=await this.mutationInternal(e,t,s);if(!n.success){if(void 0!==n.errorData)throw z(n,new Q(J("mutation",e,n)));throw Error(J("mutation",e,n))}return n.value}async mutationInternal(e,t,s,n){let{mutationPromise:r}=this.enqueueMutation(e,t,s,n);return r}enqueueMutation(e,t,s,n){let r=v(t);this.tryReportLongDisconnect();let i=this.nextRequestId;if(this._nextRequestId++,void 0!==s){let e=s.optimisticUpdate;if(void 0!==e){let t=t=>{e(t,r)instanceof Promise&&this.logger.warn("Optimistic update handler returned a Promise. Optimistic updates should be synchronous.")},s=this.optimisticQueryResults.applyOptimisticUpdate(t,i).map(e=>{let t=this.localQueryResultByToken(e);return{token:e,modification:{kind:"Updated",result:void 0===t?void 0:{success:!0,value:t,logLines:[]}}}});this.handleTransition({queries:s,reflectedMutations:[],timestamp:this.remoteQuerySet.timestamp()})}}let o={type:"Mutation",requestId:i,udfPath:e,componentPath:n,args:[E(r)]},a=this.webSocketManager.sendMessage(o);return{requestId:i,mutationPromise:this.requestManager.request(o,a)}}async action(e,t){let s=await this.actionInternal(e,t);if(!s.success){if(void 0!==s.errorData)throw z(s,new Q(J("action",e,s)));throw Error(J("action",e,s))}return s.value}async actionInternal(e,t,s){let n=v(t),r=this.nextRequestId;this._nextRequestId++,this.tryReportLongDisconnect();let i={type:"Action",requestId:r,udfPath:e,componentPath:s,args:[E(n)]},o=this.webSocketManager.sendMessage(i);return this.requestManager.request(i,o)}async close(){return this.authenticationManager.stop(),this.webSocketManager.terminate()}get url(){return this.address}get nextRequestId(){return this._nextRequestId}get sessionId(){return this._sessionId}reportMarks(){if(this.debug){let e=function(e){if("undefined"==typeof performance||!performance.getEntriesByName)return[];let t=[];for(let s of eO){let n=performance.getEntriesByName(s).filter(e=>"mark"===e.entryType).filter(t=>t.detail.sessionId===e);t.push(...n)}return t.map(eE)}(this.sessionId);this.webSocketManager.sendMessage({type:"Event",eventType:"ClientConnect",event:e})}}tryReportLongDisconnect(){if(!this.debug)return;let e=this.connectionState().timeOfOldestInflightRequest;null===e||Date.now()-e.getTime()<=6e4||fetch(`${this.address}/api/debug_event`,{method:"POST",headers:{"Content-Type":"application/json","Convex-Client":`npm-${o}`},body:JSON.stringify({event:"LongWebsocketDisconnect"})}).then(e=>{e.ok||this.logger.warn("Analytics request failed with response:",e.body)}).catch(e=>{this.logger.warn("Analytics response failed with error:",e)})}}var eL=Object.defineProperty,eQ=(e,t,s)=>{let n;return(n="symbol"!=typeof t?t+"":t)in e?eL(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s};class eF{constructor(e,t){if(eQ(this,"address"),eQ(this,"auth"),eQ(this,"adminAuth"),eQ(this,"encodedTsPromise"),eQ(this,"debug"),eQ(this,"fetchOptions"),eQ(this,"logger"),eQ(this,"mutationQueue",[]),eQ(this,"isProcessingQueue",!1),"boolean"==typeof t)throw Error("skipConvexDeploymentUrlCheck as the second argument is no longer supported. Please pass an options object, `{ skipConvexDeploymentUrlCheck: true }`.");!0!==(t??{}).skipConvexDeploymentUrlCheck&&w(e),this.logger=t?.logger===!1?new U({verbose:!1}):t?.logger!==!0&&t?.logger?t.logger:N({verbose:!1}),this.address=e,this.debug=!0,this.auth=void 0,this.adminAuth=void 0,t?.auth&&this.setAuth(t.auth)}backendUrl(){return`${this.address}/api`}get url(){return this.address}setAuth(e){this.clearAuth(),this.auth=e}setAdminAuth(e,t){if(this.clearAuth(),void 0!==t){let s=btoa(String.fromCodePoint(...new TextEncoder().encode(JSON.stringify(t))));this.adminAuth=`${e}:${s}`}else this.adminAuth=e}clearAuth(){this.auth=void 0,this.adminAuth=void 0}setDebug(e){this.debug=e}setFetchOptions(e){this.fetchOptions=e}async consistentQuery(e,...t){let s=v(t[0]),n=this.getTimestamp();return await this.queryInner(e,s,{timestampPromise:n})}async getTimestamp(){return this.encodedTsPromise?this.encodedTsPromise:this.encodedTsPromise=this.getTimestampInner()}async getTimestampInner(){let e=s||fetch,t={"Content-Type":"application/json","Convex-Client":`npm-${o}`},n=await e(`${this.address}/api/query_ts`,{...this.fetchOptions,method:"POST",headers:t});if(!n.ok)throw Error(await n.text());let{ts:r}=await n.json();return r}async query(e,...t){let s=v(t[0]);return await this.queryInner(e,s,{})}async queryInner(e,t,n){let r=er(e),i=[E(t)],a={"Content-Type":"application/json","Convex-Client":`npm-${o}`};this.adminAuth?a.Authorization=`Convex ${this.adminAuth}`:this.auth&&(a.Authorization=`Bearer ${this.auth}`);let u=s||fetch,h=n.timestampPromise?await n.timestampPromise:void 0,l=JSON.stringify({path:r,format:"convex_encoded_json",args:i,...h?{ts:h}:{}}),c=h?`${this.address}/api/query_at_ts`:`${this.address}/api/query`,d=await u(c,{...this.fetchOptions,body:l,method:"POST",headers:a});if(!d.ok&&560!==d.status)throw Error(await d.text());let f=await d.json();if(this.debug)for(let e of f.logLines??[])W(this.logger,"info","query",r,e);switch(f.status){case"success":return M(f.value);case"error":if(void 0!==f.errorData)throw ej(f.errorData,new Q(f.errorMessage));throw Error(f.errorMessage);default:throw Error(`Invalid response: ${JSON.stringify(f)}`)}}async mutationInner(e,t){let n=er(e),r=JSON.stringify({path:n,format:"convex_encoded_json",args:[E(t)]}),i={"Content-Type":"application/json","Convex-Client":`npm-${o}`};this.adminAuth?i.Authorization=`Convex ${this.adminAuth}`:this.auth&&(i.Authorization=`Bearer ${this.auth}`);let a=s||fetch,u=await a(`${this.address}/api/mutation`,{...this.fetchOptions,body:r,method:"POST",headers:i});if(!u.ok&&560!==u.status)throw Error(await u.text());let h=await u.json();if(this.debug)for(let e of h.logLines??[])W(this.logger,"info","mutation",n,e);switch(h.status){case"success":return M(h.value);case"error":if(void 0!==h.errorData)throw ej(h.errorData,new Q(h.errorMessage));throw Error(h.errorMessage);default:throw Error(`Invalid response: ${JSON.stringify(h)}`)}}async processMutationQueue(){if(!this.isProcessingQueue){for(this.isProcessingQueue=!0;this.mutationQueue.length>0;){let{mutation:e,args:t,resolve:s,reject:n}=this.mutationQueue.shift();try{let n=await this.mutationInner(e,t);s(n)}catch(e){n(e)}}this.isProcessingQueue=!1}}enqueueMutation(e,t){return new Promise((s,n)=>{this.mutationQueue.push({mutation:e,args:t,resolve:s,reject:n}),this.processMutationQueue()})}async mutation(e,...t){let[s,n]=t,r=v(s);return n?.skipQueue?await this.mutationInner(e,r):await this.enqueueMutation(e,r)}async action(e,...t){let n=v(t[0]),r=er(e),i=JSON.stringify({path:r,format:"convex_encoded_json",args:[E(n)]}),a={"Content-Type":"application/json","Convex-Client":`npm-${o}`};this.adminAuth?a.Authorization=`Convex ${this.adminAuth}`:this.auth&&(a.Authorization=`Bearer ${this.auth}`);let u=s||fetch,h=await u(`${this.address}/api/action`,{...this.fetchOptions,body:i,method:"POST",headers:a});if(!h.ok&&560!==h.status)throw Error(await h.text());let l=await h.json();if(this.debug)for(let e of l.logLines??[])W(this.logger,"info","action",r,e);switch(l.status){case"success":return M(l.value);case"error":if(void 0!==l.errorData)throw ej(l.errorData,new Q(l.errorMessage));throw Error(l.errorMessage);default:throw Error(`Invalid response: ${JSON.stringify(l)}`)}}async function(e,t,...n){let r=v(n[0]),i="string"==typeof e?e:er(e),a=JSON.stringify({componentPath:t,path:i,format:"convex_encoded_json",args:E(r)}),u={"Content-Type":"application/json","Convex-Client":`npm-${o}`};this.adminAuth?u.Authorization=`Convex ${this.adminAuth}`:this.auth&&(u.Authorization=`Bearer ${this.auth}`);let h=s||fetch,l=await h(`${this.address}/api/function`,{...this.fetchOptions,body:a,method:"POST",headers:u});if(!l.ok&&560!==l.status)throw Error(await l.text());let c=await l.json();if(this.debug)for(let e of c.logLines??[])W(this.logger,"info","any",i,e);switch(c.status){case"success":return M(c.value);case"error":if(void 0!==c.errorData)throw ej(c.errorData,new Q(c.errorMessage));throw Error(c.errorMessage);default:throw Error(`Invalid response: ${JSON.stringify(c)}`)}}}function ej(e,t){return t.data=M(e),t}var eD=e.i(71645),eB=Object.defineProperty,eU=(e,t,s)=>{let n;return(n="symbol"!=typeof t?t+"":t)in e?eB(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s};if(void 0===eD.default)throw Error("Required dependency 'react' not found");let eN=eD.default.createContext(void 0),eW=({client:e,children:t})=>eD.default.createElement(eN.Provider,{value:e},t);Symbol("includePageKeys"),Symbol("page");let eJ=(0,eD.createContext)(void 0);function ez({children:e,client:t,useAuth:s}){let{isLoading:n,isAuthenticated:r,fetchAccessToken:i}=s(),[o,a]=(0,eD.useState)(null);return n&&null!==o&&a(null),n||r||!1===o||a(!1),eD.default.createElement(eJ.Provider,{value:{isLoading:null===o,isAuthenticated:r&&(o??!1)}},eD.default.createElement(eH,{authProviderAuthenticated:r,fetchAccessToken:i,authProviderLoading:n,client:t,setIsConvexAuthenticated:a}),eD.default.createElement(eW,{client:t},e),eD.default.createElement(eG,{authProviderAuthenticated:r,fetchAccessToken:i,authProviderLoading:n,client:t,setIsConvexAuthenticated:a}))}function eH({authProviderAuthenticated:e,fetchAccessToken:t,authProviderLoading:s,client:n,setIsConvexAuthenticated:r}){return(0,eD.useEffect)(()=>{let s=!0;if(e)return n.setAuth(t,e=>{s&&r(()=>e)}),()=>{s=!1,r(e=>!e&&null)}},[e,t,s,n,r]),null}function eG({authProviderAuthenticated:e,fetchAccessToken:t,authProviderLoading:s,client:n,setIsConvexAuthenticated:r}){return(0,eD.useEffect)(()=>{if(e)return()=>{n.clearAuth(),r(()=>null)}},[e,t,s,n,r]),null}let eX=Object.prototype.toString,eK=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]),eY=[500,2e3],eZ=(0,eD.createContext)(void 0),e0=(0,eD.createContext)(void 0);function e1(){return(0,eD.useContext)(e0)}let e3=(0,eD.createContext)(null),e2="__convexAuthOAuthVerifier",e5="__convexAuthJWT",e6="__convexAuthRefreshToken",e4="__convexAuthServerStateFetchTime";function e8({client:e,serverState:t,onChange:s,shouldHandleCode:n,storage:r,storageNamespace:o,replaceURL:a,children:u}){var h,l;let c,d,f,g,y=(0,eD.useRef)(t?._state.token??null),[p,m]=(0,eD.useState)(null===y.current),[v,w]=(0,eD.useState)(y.current),b=e.verbose??!1,S=(0,eD.useCallback)(t=>{b&&(console.debug(`${new Date().toISOString()} ${t}`),e.logger?.logVerbose(t))},[b]),{storageSet:k,storageGet:C,storageRemove:A,storageKey:R}=(h=r,l=o,c=function(){let[e,t]=(0,eD.useState)({});return()=>({getItem:t=>e[t],setItem:(e,s)=>{t(t=>({...t,[e]:s}))},removeItem:e=>{t(t=>{let{[e]:s,...n}=t;return n})}})}(),d=(0,eD.useMemo)(()=>h??c(),[h]),f=l.replace(/[^a-zA-Z0-9]/g,""),g=(0,eD.useCallback)(e=>`${e}_${f}`,[l]),{storageSet:(0,eD.useCallback)((e,t)=>d.setItem(g(e),t),[d,g]),storageGet:(0,eD.useCallback)(e=>d.getItem(g(e)),[d,g]),storageRemove:(0,eD.useCallback)(e=>d.removeItem(g(e)),[d,g]),storageKey:g}),[T,q]=(0,eD.useState)(!1),x=(0,eD.useCallback)(async e=>{let t,n=null!==y.current;if(null===e.tokens)y.current=null,e.shouldStore&&(await A(e5),await A(e6)),t=null;else{let{token:s}=e.tokens;if(y.current=s,e.shouldStore){let{refreshToken:t}=e.tokens;await k(e5,s),await k(e6,t)}t=s}n!==(null!==t)&&await s?.(),w(t),m(!1)},[k,A]);(0,eD.useEffect)(()=>{let e=async e=>{if(T)return e.preventDefault(),e.returnValue=!0,"Are you sure you want to leave? Your changes may not be saved."};return tn("beforeunload",e),()=>{tr("beforeunload",e)}}),(0,eD.useEffect)(()=>{let e=e=>{(async()=>{if(e.storageArea===r&&e.key===R(e5)){let t=e.newValue;S(`synced access token, is null: ${null===t}`),await x({shouldStore:!1,tokens:null===t?null:{token:t}})}})()};return tn("storage",e),()=>tr("storage",e)},[x]);let $=(0,eD.useCallback)(async t=>{let s,n=0;for(;n<eY.length;)try{return await e.unauthenticatedCall("auth:signIn","code"in t?{params:{code:t.code},verifier:t.verifier}:t)}catch(t){if(s=t,!function(e){if(!(e&&"[object Error]"===eX.call(e)&&"TypeError"===e.name&&"string"==typeof e.message))return!1;let{message:t,stack:s}=e;return"Load failed"===t?void 0===s||"__sentry_captured__"in e:!!t.startsWith("error sending request for url")||eK.has(t)}(t))break;let e=eY[n]+100*Math.random();n++,S(`verifyCode failed with network error, retry ${n} of ${eY.length} in ${e}ms`),await new Promise(t=>setTimeout(t,e))}throw s},[e]),M=(0,eD.useCallback)(async e=>{let{tokens:t}=await $(e);return S(`retrieved tokens, is null: ${null===t}`),await x({shouldStore:!0,tokens:t??null}),null!==t},[e,x]),I=(0,eD.useCallback)(async(t,s)=>{let n=s instanceof FormData?Array.from(s.entries()).reduce((e,[t,s])=>(e[t]=s,e),{}):s??{},r=await C(e2)??void 0;await A(e2);let i=await e.authenticatedCall("auth:signIn",{provider:t,params:n,verifier:r});if(void 0!==i.redirect){let e=new URL(i.redirect);return await k(e2,i.verifier),"ReactNative"!==navigator.product&&(window.location.href=e.toString()),{signingIn:!1,redirect:e}}if(void 0!==i.tokens){let{tokens:e}=i;return S(`signed in and got tokens, is null: ${null===e}`),await x({shouldStore:!0,tokens:e}),{signingIn:null!==i.tokens}}return{signingIn:!1}},[e,x,C]),O=(0,eD.useCallback)(async()=>{try{await e.authenticatedCall("auth:signOut")}catch(e){}S("signed out, erasing tokens"),await x({shouldStore:!0,tokens:null})},[x,e]),E=(0,eD.useCallback)(async({forceRefreshToken:e})=>{if(e){let e=y.current;return await e7(e6,async()=>{let t=y.current;if(t!==e)return S(`returning synced token, is null: ${null===t}`),t;let s=await C(e6)??null;return null!==s?(q(!0),await M({refreshToken:s}).finally(()=>{q(!1)}),S(`returning retrieved token, is null: ${null===t}`),y.current):(q(!1),S("returning null, there is no refresh token"),null)})}return y.current},[M,O,C]),_=(0,eD.useRef)(!1);(0,eD.useEffect)(()=>{if(void 0===r)throw Error("`localStorage` is not available in this environment, set the `storage` prop on `ConvexAuthProvider`!");let e=async()=>{let e=await C(e5)??null;S(`retrieved token from storage, is null: ${null===e}`),await x({shouldStore:!1,tokens:null===e?null:{token:e}})};if(void 0!==t){let s=C(e4),n=s=>{if(!s||t._timeFetched>+s){let{token:e,refreshToken:s}=t._state;k(e4,t._timeFetched.toString()),x({tokens:null===e||null===s?null:{token:e,refreshToken:s},shouldStore:!0})}else e()};s instanceof Promise?s.then(n):n(s);return}let s=void 0!==window?.location?.search?new URLSearchParams(window.location.search).get("code"):null;if((_.current||s)&&!_.current&&(void 0===n||("function"==typeof n?n():n))){_.current=!0;let e=new URL(window.location.href);e.searchParams.delete("code"),(async()=>{await a(e.pathname+e.search+e.hash),await I(void 0,{code:s}),_.current=!1})()}else e()},[e,C]);let V=(0,eD.useMemo)(()=>({signIn:I,signOut:O}),[I,O]),P=null!==v,L=(0,eD.useMemo)(()=>({isLoading:p,isAuthenticated:P,fetchAccessToken:E}),[E,p,P]);return(0,i.jsx)(e0.Provider,{value:L,children:(0,i.jsx)(eZ.Provider,{value:V,children:(0,i.jsx)(e3.Provider,{value:v,children:u})})})}async function e7(e,t){let s=window?.navigator?.locks;return void 0!==s?await s.request(e,t):await ts(e,t)}function e9(e){void 0===globalThis.__convexAuthMutexes&&(globalThis.__convexAuthMutexes={});let t=globalThis.__convexAuthMutexes[e];return void 0===t&&(globalThis.__convexAuthMutexes[e]={currentlyRunning:null,waiting:[]}),t=globalThis.__convexAuthMutexes[e]}function te(e,t){globalThis.__convexAuthMutexes[e]=t}async function tt(e,t){let s=e9(e);null===s.currentlyRunning?te(e,{currentlyRunning:t().finally(()=>{let t=e9(e).waiting.shift();e9(e).currentlyRunning=null,te(e,{...e9(e),currentlyRunning:void 0===t?null:tt(e,t)})}),waiting:[]}):te(e,{...s,waiting:[...s.waiting,t]})}async function ts(e,t){return new Promise((s,n)=>{tt(e,()=>t().then(e=>s(e)).catch(e=>n(e)))})}function tn(e,t,s){window.addEventListener?.(e,t,s)}function tr(e,t,s){window.removeEventListener?.(e,t,s)}function ti(e){let{client:t,storage:s,storageNamespace:n,replaceURL:r,shouldHandleCode:o,children:a}=e,u=(0,eD.useMemo)(()=>({authenticatedCall:(e,s)=>t.action(e,s),unauthenticatedCall:(e,s)=>new eF(t.address,{logger:t.logger}).action(e,s),verbose:t.options?.verbose,logger:t.logger}),[t]);return(0,i.jsx)(e8,{client:u,storage:s??("undefined"==typeof window?void 0:window?.localStorage),storageNamespace:n??t.address,replaceURL:r??(e=>{window.history.replaceState({},"",e)}),shouldHandleCode:o,children:(0,i.jsx)(ez,{client:t,useAuth:e1,children:a})})}let to=new class{constructor(e,t){if(eU(this,"address"),eU(this,"cachedSync"),eU(this,"listeners"),eU(this,"options"),eU(this,"closed",!1),eU(this,"_logger"),eU(this,"adminAuth"),eU(this,"fakeUserIdentity"),void 0===e)throw Error("No address provided to ConvexReactClient.\nIf trying to deploy to production, make sure to follow all the instructions found at https://docs.convex.dev/production/hosting/\nIf running locally, make sure to run `convex dev` and ensure the .env.local file is populated.");if("string"!=typeof e)throw Error(`ConvexReactClient requires a URL like 'https://happy-otter-123.convex.cloud', received something of type ${typeof e} instead.`);if(!e.includes("://"))throw Error("Provided address was not an absolute URL.");this.address=e,this.listeners=new Map,this._logger=t?.logger===!1?new U({verbose:t?.verbose??!1}):t?.logger!==!0&&t?.logger?t.logger:N({verbose:t?.verbose??!1}),this.options={...t,logger:this._logger}}get url(){return this.address}get sync(){if(this.closed)throw Error("ConvexReactClient has already been closed.");return this.cachedSync||(this.cachedSync=new eP(this.address,e=>this.transition(e),this.options),this.adminAuth&&this.cachedSync.setAdminAuth(this.adminAuth,this.fakeUserIdentity)),this.cachedSync}setAuth(e,t){if("string"==typeof e)throw Error("Passing a string to ConvexReactClient.setAuth is no longer supported, please upgrade to passing in an async function to handle reauthentication.");this.sync.setAuth(e,t??(()=>{}))}clearAuth(){this.sync.clearAuth()}setAdminAuth(e,t){if(this.adminAuth=e,this.fakeUserIdentity=t,this.closed)throw Error("ConvexReactClient has already been closed.");this.cachedSync&&this.sync.setAdminAuth(e,t)}watchQuery(e,...t){let[s,n]=t,r=er(e);return{onUpdate:e=>{let{queryToken:t,unsubscribe:i}=this.sync.subscribe(r,s,n),o=this.listeners.get(t);return void 0!==o?o.add(e):this.listeners.set(t,new Set([e])),()=>{if(this.closed)return;let s=this.listeners.get(t);s.delete(e),0===s.size&&this.listeners.delete(t),i()}},localQueryResult:()=>{if(this.cachedSync)return this.cachedSync.localQueryResult(r,s)},localQueryLogs:()=>{if(this.cachedSync)return this.cachedSync.localQueryLogs(r,s)},journal:()=>{if(this.cachedSync)return this.cachedSync.queryJournal(r,s)}}}prewarmQuery(e){let t=e.extendSubscriptionFor??5e3;setTimeout(this.watchQuery(e.query,e.args||{}).onUpdate(()=>{}),t)}mutation(e,...t){let[s,n]=t,r=er(e);return this.sync.mutation(r,s,n)}action(e,...t){let s=er(e);return this.sync.action(s,...t)}query(e,...t){let s=this.watchQuery(e,...t),n=s.localQueryResult();return void 0!==n?Promise.resolve(n):new Promise((e,t)=>{let n=s.onUpdate(()=>{n();try{e(s.localQueryResult())}catch(e){t(e)}})})}connectionState(){return this.sync.connectionState()}subscribeToConnectionState(e){return this.sync.subscribeToConnectionState(e)}get logger(){return this._logger}async close(){if(this.closed=!0,this.listeners=new Map,this.cachedSync){let e=this.cachedSync;this.cachedSync=void 0,await e.close()}}transition(e){for(let t of e){let e=this.listeners.get(t);if(e)for(let t of e)t()}}}("https://colorless-gecko-65.convex.cloud");function ta({children:e}){return to?(0,i.jsx)(ti,{client:to,children:e}):(0,i.jsx)(i.Fragment,{children:e})}e.s(["ConvexClientProvider",()=>ta],85313)}]);